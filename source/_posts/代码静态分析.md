---
title: 代码静态分析
date: 2023-04-28 18:02:37
tags:
---
### 腾讯云静态分析
- TCA, Tencent Cloud Code Analysis  code-named: CodeDog
- https://cloud.tencent.com/product/tcap
- https://github.com/Tencent/CodeAnalysis
- https://github.com/Tencent/CodeAnalysis/blob/main/README_ZH.md



#### Dart Analyzer
- Flutter针对Android Studio和VS Code开发的插件，使用Android Studio或者VS Code进行开发，不需要配置就可以看到Dart Analyzer工具提供的静态分析结果
- Dart Analyzer工具会使用默认的analysis_options.yaml文件中的内容执行代码静态分析


#### typescript
- https://jkchao.github.io/typescript-book-chinese/compiler/scanner.html#%E8%A7%A3%E6%9E%90%E5%99%A8%E5%AF%B9%E6%89%AB%E6%8F%8F%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8
#### tools
- https://www.softwaresecured.com/
- https://www.veracode.com/products/binary-static-analysis-sast
- https://embold.io/
- https://deepscan.io/
- https://www.codacy.com/
- https://www.sonarsource.com/products/sonarqube/
- https://deepsource.com/



### 基于 AST 的代码处理工具工作流程
#### Parsing（解析）
这个过程由编译器实现，会经过词法分析和语法分析两个过程，生成 AST

#### Traversing（遍历）
深度优先遍历 AST ，访问树上各个节点的信息

#### Transforming（修改）
在遍历的过程中可对节点信息进行修改/转化，生成新的 AST

#### Printing（输出）
将转化后新的 AST 输出成新的代码块

### 编译器 Parser
- Parser 的 API 可以帮助我们完成代码的词法分析与语法分析，并返回对应的 AST 对象
- JS Parser： esprima、 acorn、 espree、@babel/parser。
- TS Parser：typescript (https://github.com/microsoft/TypeScript/)


## cases
### 依赖调用分析
- 遍历其所有 import 节点，分析并记录从目标依赖引入的 API 信息，并排除非目标依赖项的干扰。

- 判定引入的 API 在具体代码中是否有调用，过程中还需要排除局部同名变量等一系列干扰。

- 根据分析指标如用途识别等对该 API 调用进行指标判定分析，命中则记录到指定 Map 中。

- 依次遍历所有项目中指定的 TS(JS) 文件，就可以得到全部应用对于特定依赖的 API 调用分析数据了，最后根据使用场景（告警、评分、代码报告、代码建议等）对分析数据进行标记，二次整理，即可输出最终的分析结


### 抽象成分析模型 - 如何设计解决问题的通用方法论
#### 依赖调用分析模型
- 依赖调用方
- 依赖提供方
- 面向对象编程
```
Webpack - Compiler
```
- 生成一个基础类
### codeAnalysis
- Webpack：把依赖调用分析过程中涉及的方法，属性都封装在名为 codeAnalysis 的基础类中
- 依赖调用分析流程的抽象，在生成分析实例后，通过实例来驱动整个分析流程
- 基础类中包括扫描代码文件、解析 AST、遍历 AST、统计信息、安装插件、执行插件、链式检查、黑名单标记和代码评分等在内的一系列方法，重要属性

### 分析范式
- 执行时序 -> 执行生命周期（分析范式）
- 根据分析范式步骤完善基础类的过程就是实现代码分析工具的过程

### 解耦性、拓展性、可用性
- 辅助模块
- 架构设计: 解耦性、拓展性、可用性