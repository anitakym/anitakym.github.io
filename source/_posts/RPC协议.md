---
title: RPC协议
date: 2021-11-05 14:04:56
tags:
---

> remote procedure call 远程过程调用

## RPC协议（跨语言类）
- ONC RPC
- （XML） SOAP
- （JSON）RESTful
- Hessian2

> 二进制传输性能好，难以跨语言；文本类的则相反；

## 模式演变
- 客户端服务器模式
- 微服务

## 对RPC框架的要求
- 传输性能
- 跨语言
- 严谨且灵活（添加字段不需要重新编译发布程序）
- 服务发现，服务治理（Dubbo ｜ Spring Cloud）

## GRPC
### 二进制序列化协议
- Protocol Buffers
- .proto
- 压缩效率很高

### 网络传输
- Java - Netty(高效的基于异步IO的网络传输框架) - 见netty-summary
- 服务方法 - 单向RPC ｜ 服务端流式RPC ｜ 客户端流失RPC ｜ 双向流式RPC

### 服务发现(Discovery Service)与治理
- 负载均衡 - LVS HAProxy Nginx
- Envoy - GRPC
- 配置 - listener ｜ endpoint ｜ cluster ｜ route
- 注册治理中心
- 未来服务治理的趋势 - Service Mesh(基于Envoy)

#### 注册治理中心
- https://mp.weixin.qq.com/s/IhPfssotldNWn9GF4Dx6qg - 腾讯注册中心演进及性能优化实践

Dubbo是一个高性能、轻量级的开源Java RPC框架，它是阿里巴巴集团开发和开源的服务化治理解决方案，对于构建大规模的分布式应用系统具有重要的作用。

Dubbo主要提供以下核心功能：

1. **透明化的远程方法调用**：把RPC调用转换为本地调用，服务消费者无需知道远程调用的细节，就像调用本地方法一样方便。

2. **负载均衡**：Dubbo支持多种负载均衡策略，如随机（Random）、轮询（Round Robin）、最小活跃调用数（Least Active）等。

3. **服务注册与发现**：通过注册中心对服务提供者进行注册和服务消费者进行发现，实现了服务消费者和服务提供者的解耦。

4. **容错机制**：包括失败自动切换、超时重试等多种容错方式，可以保证服务的高可用性。

5. **服务治理**：包括动态配置、访问控制、权重调整、负载均衡、熔断与降级等一系列服务治理功能。

6. **分布式事务**：通过集群内部协调，实现服务间的一致性。

7. **监控**：提供丰富的服务调用监控、访问日志、统计及报警系统。

Dubbo接口安全性增强的策略：

访问控制列表（ACL）：通过配置白名单或黑名单来管理哪些消费端可以或不能访问你的服务。

服务降级：在消费端或者提供端配置mock结果，当服务出现异常时，可以根据mock的策略来返回“mock结果”，防止服务尝试不当访问。

令牌验证：可以对接口调用进行令牌验证，只有持有有效令牌的消费端才能访问。

数字签名：消费端和提供者端可以采用相同的签名算法，提供者用于检验请求的合法性，消费者用来确认回复的正确性。

传输层安全（TLS）：可以使用Dubbo的TLS支持在传输数据时进行加密，防止数据被截获。

限流：通过设置每秒请求数量的上限，防止因过度请求而导致服务崩溃。

## 通信协议
Dubbo和Feign都是常用的微服务架构中的通信协议，但他们之间有一些关键的区别：

1. Dubbo: 它是由阿里巴巴开发的一个高效能、基于Java的开源远程过程调用（RPC）框架。Dubbo提供了三个主要的功能，包括基于接口的远程调用、容错和负载均衡，以及自动的服务注册和发现。

2. Feign: Feign是由Netflix开发的一个声明式的网络服务客户端，主要用于简化HTTP请求的调用和阅读。与传统的使用HttpUrlConnection 或 HttpClient的方式相比，Feign使用注解来定义和自定义HTTP请求，从而简化了处理HTTP API的过程。

所以，选择使用Dubbo还是Feign主要取决于您的微服务应用的需求。