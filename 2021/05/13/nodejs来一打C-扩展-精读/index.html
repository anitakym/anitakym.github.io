<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="ImaginingMe">
    <meta name="keyword"  content="frontend">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        nodejs来一打C++扩展-精读 - 前端技术分享 | AnitaK&#39;s Blog
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 5.0.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> DICHTEN == CONDENSARE </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="http://www.imaginingme.cn/img/avatar.jpeg" />
        </div>
        <div class="name">
            <i>ImaginingMe</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-js-%E7%9A%84-C-%E6%89%A9%E5%B1%95%E5%89%8D%E9%A9%B1%E7%9F%A5%E8%AF%86%E5%82%A8%E5%A4%87"><span class="toc-text">Node.js 的 C++ 扩展前驱知识储备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-%E7%9A%84%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B6"><span class="toc-text">Node.js 的模块机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CommonJS-%E7%9A%84%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83"><span class="toc-text">CommonJS 的模块规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Node-js-%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="toc-text">Node.js 的模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-%E7%9A%84%E5%8C%85%E6%9C%BA%E5%88%B6"><span class="toc-text">Node.js 的包机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CommonJS-%E7%9A%84%E5%8C%85%E8%A7%84%E8%8C%83-9"><span class="toc-text">CommonJS 的包规范 9</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Node-js-NPM-%E4%B8%8B%E7%9A%84%E5%8C%85-13"><span class="toc-text">Node.js &#x2F; NPM 下的包 13</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NPM-%E4%B8%8E-CNPM-16"><span class="toc-text">NPM 与 CNPM 16</span></a></li></ol></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> DICHTEN == CONDENSARE </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        nodejs来一打C++扩展-精读
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2021-05-13 01:57:05</span></span>
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <blockquote>
<p>nodejs来一打C++扩展-死月</p>
</blockquote>
<h2 id="Node-js-的-C-扩展前驱知识储备"><a href="#Node-js-的-C-扩展前驱知识储备" class="headerlink" title="Node.js 的 C++ 扩展前驱知识储备"></a>Node.js 的 C++ 扩展前驱知识储备</h2><h3 id="Node-js-的模块机制"><a href="#Node-js-的模块机制" class="headerlink" title="Node.js 的模块机制"></a>Node.js 的模块机制</h3><h4 id="CommonJS-的模块规范"><a href="#CommonJS-的模块规范" class="headerlink" title="CommonJS 的模块规范"></a>CommonJS 的模块规范</h4><h4 id="Node-js-的模块"><a href="#Node-js-的模块" class="headerlink" title="Node.js 的模块"></a>Node.js 的模块</h4><h3 id="Node-js-的包机制"><a href="#Node-js-的包机制" class="headerlink" title="Node.js 的包机制"></a>Node.js 的包机制</h3><h4 id="CommonJS-的包规范-9"><a href="#CommonJS-的包规范-9" class="headerlink" title="CommonJS 的包规范 9"></a>CommonJS 的包规范 9</h4><h4 id="Node-js-NPM-下的包-13"><a href="#Node-js-NPM-下的包-13" class="headerlink" title="Node.js / NPM 下的包 13"></a>Node.js / NPM 下的包 13</h4><h4 id="NPM-与-CNPM-16"><a href="#NPM-与-CNPM-16" class="headerlink" title="NPM 与 CNPM 16"></a>NPM 与 CNPM 16</h4><p>1.3 Node.js 依赖简介 20</p>
<p>1.3.1 Chrome V8 20</p>
<p>1.3.2 libuv 25</p>
<p>1.3.3 其他依赖 28</p>
<p>1.3.4 小结 30</p>
<p>1.3.5 参考资料 30</p>
<p>1.4 C++ 扩展开发的准备工作 31</p>
<p>1.4.1 编辑器 / IDE 31</p>
<p>1.4.2 node-gyp 36</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/nodejs/node-gyp#installation">https://github.com/nodejs/node-gyp#installation</a></li>
</ul>
<p>1.4.3 其他构建工具 54</p>
<p>1.4.4 小结 56</p>
<p>1.4.5 参考资料 56</p>
<p>2 C++ 模块原理简析 57</p>
<p>2.1 为什么要写 C++ 模块 57</p>
<p>2.1.1 C++ 比 JavaScript 解释器高效 57</p>
<p>2.1.2 已有的 C++ 轮子 72</p>
<p>2.1.3 小结 77</p>
<p>2.1.4 参考资料 77</p>
<p>2.2 什么是 C++ 扩展 78</p>
<p>2.2.1 C++ 模块本质 78</p>
<p>2.2.2 Node.js 模块加载原理 80</p>
<p>2.2.3 小结 102</p>
<p>2.2.4 参考资料 103</p>
<p>3 Chrome V8 基础 104</p>
<p>3.1 Node.js 与 Chrome V8 104</p>
<p>3.2 基本概念 105</p>
<p>3.2.1 内存机制 105</p>
<p>3.2.2 隔离实例（Isolate） 108</p>
<p>3.2.3 上下文（Context） 109</p>
<p>3.2.4 脚本（Script） 110</p>
<p>3.2.5 小结 110</p>
<p>3.2.6 参考资料 111</p>
<p>3.3 句柄（Handle） 111</p>
<p>3.3.1 本地句柄（Local） 112</p>
<p>3.3.2 持久句柄（Persistent） 115</p>
<p>3.3.3 永生句柄（Eternal） 119</p>
<p>3.3.4 待实本地句柄（Maybe Local） 119</p>
<p>3.3.5 小结 121</p>
<p>3.3.6 参考资料 121</p>
<p>3.4 句柄作用域 121</p>
<p>3.4.1 一般句柄作用域（Handle Scope） 122</p>
<p>3.4.2 可逃句柄作用域（Escapable Handle Scope） 125</p>
<p>3.4.3 小结 129</p>
<p>3.4.4 参考资料 129</p>
<p>3.5 上下文（Context） 129</p>
<p>3.6 模板（Template） 133</p>
<p>3.6.1 函数模板（Function Template） 133</p>
<p>3.6.2 对象模板（Object Template） 138</p>
<p>3.6.3 对象模板的访问器（Accessor）与拦截器（Interceptor） 144</p>
<p>3.6.4 对象模板的内置字段（Internal Field） 175</p>
<p>3.6.5 函数模板的继承（Inherit） 183</p>
<p>3.6.6 小结 188</p>
<p>3.6.7 参考资料 189</p>
<p>3.7 常用数据类型 189</p>
<p>3.7.1 基值（Value） 189</p>
<p>3.7.2 字符串（String） 194</p>
<p>3.7.3 数值类型 196</p>
<p>3.7.4 布尔类型（Boolean） 196</p>
<p>3.7.5 对象（Object） 196</p>
<p>3.7.6 函数（Function） 200</p>
<p>3.7.7 数组（Array） 202</p>
<p>3.7.8 JSON 解析器 203</p>
<p>3.7.9 函数回调信息（Function Callback Info） 203</p>
<p>3.7.10 函数返回值（Return Value） 204</p>
<p>3.7.11 隔离实例（Isolate） 204</p>
<p>3.7.12 小结 205</p>
<p>3.7.13 参考资料 206</p>
<p>3.8 异常机制 206</p>
<p>3.8.1 try-catch 206</p>
<p>3.8.2 抛出异常 209</p>
<p>3.8.3 异常生成类（Exception） 211</p>
<p>3.8.4 小结 211</p>
<p>3.8.5 参考资料 211</p>
<p>4 C++ 扩展实战初探 212</p>
<p>4.1 binding.gyp 212</p>
<p>4.1.1 惊鸿一瞥 213</p>
<p>4.1.2 binding.gyp 基础结构 213</p>
<p>4.1.3 GYP 文件 214</p>
<p>4.1.4 常用字段 221</p>
<p>4.1.5 小结 228</p>
<p>4.1.6 参考资料 228</p>
<p>4.2 牛刀小试 229</p>
<p>4.2.1 又是 Hello World 229</p>
<p>4.2.2 函数参数 232</p>
<p>4.2.3 回调函数 234</p>
<p>4.2.4 函数返回 238</p>
<p>4.2.5 小结 239</p>
<p>4.2.6 参考资料 240</p>
<p>4.3 循序渐进 240</p>
<p>4.3.1 C++ 与 JavaScript 类封装 240</p>
<p>4.3.2 实例化 C++ 类封装对象的函数 250</p>
<p>4.3.3 将 C++ 类封装对象传来传去 253</p>
<p>4.3.4 进程退出钩子 255</p>
<p>4.3.5 小结 259</p>
<p>4.3.6 参考资料 259</p>
<p>5 Node.js 原生抽象——NAN 260</p>
<p>5.1 Node.js 原生模块开发方式的变迁 260</p>
<p>5.1.1 以不变应万变 260</p>
<p>5.1.2 时代在召唤 261</p>
<p>5.1.3 小结 267</p>
<p>5.1.4 参考资料 267</p>
<p>5.2 基础开发 267</p>
<p>5.2.1 什么是 NAN 267</p>
<p>5.2.2 安装和配置 269</p>
<p>5.2.3 先睹为快——搭上NAN 的快车 270</p>
<p>5.2.4 基础帮助函数和宏 276</p>
<p>5.2.5 忽略 node_modules 279</p>
<p>5.2.6 小结 279</p>
<p>5.2.7 参考资料 280</p>
<p>5.3 JavaScript 函数 280</p>
<p>5.3.1 函数参数类型 280</p>
<p>5.3.2 函数声明 282</p>
<p>5.3.3 函数设置 288</p>
<p>5.3.4 小结 296</p>
<p>5.3.5 参考资料 296</p>
<p>5.4 常用帮助类与函数 296</p>
<p>5.4.1 句柄相关 296</p>
<p>5.4.2 创建数据对象 298</p>
<p>5.4.3 与数据对象“玩耍” 300</p>
<p>5.4.4 封装一个类 314</p>
<p>5.4.5 异常处理 315</p>
<p>5.4.6 小结 315</p>
<p>5.4.7 参考资料 316</p>
<p>5.5 NAN 中的异步机制 316</p>
<p>5.5.1 Nan::AsyncQueueWorker 316</p>
<p>5.5.2 Nan::Callback 317</p>
<p>5.5.3 Nan::AsyncWorker 317</p>
<p>5.5.4 Nan::AsyncProgressWorker 323</p>
<p>5.5.5 小结 327</p>
<p>5.5.6 参考资料 327</p>
<p>6 异步之旅——libuv 328</p>
<p>6.1 基础概念 329</p>
<p>6.1.1 事件循环 330</p>
<p>6.1.2 句柄（Handle）与请求（Request） 333</p>
<p>6.1.3 尝尝甜头 335</p>
<p>6.1.4 小结 340</p>
<p>6.1.5 参考资料 340</p>
<p>6.2 libuv 的跨线程编程基础 341</p>
<p>6.2.1 libuv 的线程 342</p>
<p>6.2.2 同步原语（Synchronization Primitive） 347</p>
<p>6.2.3 工作队列 355</p>
<p>6.2.4 小结 356</p>
<p>6.2.5 参考资料 357</p>
<p>6.3 跨线程通信 357</p>
<p>6.3.1 uv_async_t 句柄 357</p>
<p>6.3.2 Watchdog 半成品实战解析 358</p>
<p>6.3.3 Watchdog 试运行 367</p>
<p>6.3.4 小结 368</p>
<p>6.3.5 参考资料 369</p>
<p>7 实战——文件监视器 370</p>
<p>7.1 准备工作 370</p>
<p>7.1.1 功能规划 370</p>
<p>7.1.2 文件系统监听库——efsw 373</p>
<p>7.1.3 小结 376</p>
<p>7.1.4 参考资料 376</p>
<p>7.2 核心设计 376</p>
<p>7.2.1 API 设计 377</p>
<p>7.2.2 EFSWCore 的血肉之躯 377</p>
<p>7.2.3 EFSWCore 的灵魂 381</p>
<p>7.2.4 小结 385</p>
<p>7.3 编写JavaScript 类 386</p>
<p>7.3.1 类的设计 386</p>
<p>7.3.2 核心逻辑 388</p>
<p>7.3.3 简单容错 391</p>
<p>7.3.4 小结 393</p>
<p>7.4 进一步完善 393</p>
<p>7.4.1 C++ 代码的完善 393</p>
<p>7.4.2 JavaScript 代码的完善 398</p>
<p>7.4.3 小结 400</p>
<p>8 实战——现有包剖析 401</p>
<p>8.1 字符串哈希模块——Bling Hashes 401</p>
<p>8.1.1 文件设定 402</p>
<p>8.1.2 C++ 源码剖析 403</p>
<p>8.1.3 JavaScript 源码剖析 408</p>
<p>8.1.4 小结 409</p>
<p>8.1.5 参考资料 410</p>
<p>8.2 类 Proxy 包——Auto Object 410</p>
<p>8.2.1 Proxy 410</p>
<p>8.2.2 Auto Object 使用范例 412</p>
<p>8.2.3 代码剖析 415</p>
<p>8.2.4 小结 424</p>
<p>8.2.5 参考资料 424</p>
<p>9 N-API——下一代 Node.js C++ 扩展开发方式 425</p>
<p>9.1 浅尝辄止 426</p>
<p>9.1.1 实现一个 Echo 函数 426</p>
<p>9.1.2 尝试运行 N-API 扩展 430</p>
<p>9.1.3 向下兼容 431</p>
<p>9.1.4 N-API Package——C++ 封装 433</p>
<p>9.1.5 小结 433</p>
<p>9.1.6 参考资料 433</p>
<p>9.2 基本数据类型与错误处理 433</p>
<p>9.2.1 基本数据类型 433</p>
<p>9.2.2 与作用域及生命周期相关的数据类型 435</p>
<p>9.2.3 回调数据类型 438</p>
<p>9.2.4 错误处理 439</p>
<p>9.2.5 模块注册 441</p>
<p>9.2.6 小结 442</p>
<p>9.2.7 参考资料 442</p>
<p>9.3 对象与函数 442</p>
<p>9.3.1 对象 442</p>
<p>9.3.2 函数 448</p>
<p>9.3.3 类的封装 453</p>
<p>9.3.4 小结 455</p>
<p>9.3.5 参考资料 455</p>

        
            <div class="donate-container">
    <div class="donate-button">
        <button id="donate-button">赞赏</button>
    </div>
    <div class="donate-img-container hide" id="donate-img-container">
        <img id="donate-img" src="" data-src="img/donate.jpg">
        <p> 感谢鼓励 </p>
    </div>
</div>
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/anitakym">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><p>京ICP备19049908号-1</p></a>
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
